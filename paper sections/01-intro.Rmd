---
title: "Introduction"
output: html_document
bibliography: bibliography.bib
---

As ecology has progressed as a quantitative discipline and the questions ecologists ask have become more complicated, the statistical techniques ecologists use have increased in their flexibility to model complex relationships. Two of the most popular and powerful techniques now in use are generalized additive models (GAMs) for modelling non-linear regression functions, and hierarchical linear models (HLMs) for modelling between-group variability in regression relationships. 

At first glance, GAMs and HLMs are very different tools. GAMs are used to estimate smooth functional relationships between predictor (**x**) variables and outcome variables (*y*). Typically they are used to estimate a single functional relationship between **x** and *y*, $y = f(x)$ (although these relationships can be complex and include the effects of multiple interacting predictor variables). HLMs, on the other hand, are used to estimate linear relationships between *x* and *y* variables, where the *x* values are organized into groups and the relationships between *x* and *y* may differ between those groups, so that $y = a_i + b_i\cdot x$ (where $a_i$ and $b_i$ represent group-specific intercepts and slopes). At their core, though, GAMs and HLMs use very similar statistical machinery: penalized maximum likelihood. GAMs fit smooth curves by finding combinations of simpler curves that best fit the observed data while simulatenously penalizing overly wiggly curves. HLMs fit group-level predictors while penalizing how far each group level parameter deviates from the average parameter value across all groups (see section II for more details on these connections). For both GAMs and HLMs, the principle concept is that we can efficiently fit potentially highly variable models by "pooling" parameter estimates towards one another. These connections are so deep that HLMs and GAMs can both be fit using the same software. 

Given this connection, there is an obvious extension to the standard GAM framework: allow the smooth functional relationship between **x** and *y* to vary between different grouping levels of of **x**, so that $y = f_i(x)$, but penalize these functions to that the different functions $f_i$ are in some sense pooled toward each other. We often want to know both how the functional relationship between x and y vary between groups, and if there is a strong relationship on average between x and y across groups. We will refer to this type of model as a hiearchical GAM. 


There are many potential uses for hierarchical GAMs. For example, estimating how mortality rates of multiple species in a community respond to a common temperature gradient. Each species will typically have its own response function, but since the species all overlap in range, they should have similar responses over at least some temperature range. Estimating a single temperature-mortality relationship could result in a single function that did not fit any species well. Alternatively, estimating a seperate function for each species throws away a lot of shared information and could result in highly noisy function estimates if there were only a few data points for each species. Ideally, we would want a hierachical model that fit a single global temperature-mortality curve plus species-specific curves that were penalized to be close to the mean function. 


The capability to fit hiearchical GAMs already exist in the popular *mgcv* package for the R statistical language, but many ecologists are not aware of the different options available, what the trade-offs between these smoothers might be, and what different choices of group-wise smoothers assume about the underlying ecological relationships. This paper will cover the different approaches to group-level smoothing, the options for each one and why a user might choose it, and demonstrate the different approaches across a range of case studies. 


This paper is divided into six sections. Part II is a brief (and friendly) review of how penalized spline regression and hierarchical models work, focusing on the connections between the two techniques. In part III, we discuss different ways of modelling hierarchical additive models, what assumptions each model makes about how information is shared between groups, and different ways of specifying these models in *mgcv*. In part IV, we discuss some of the computational and statistical issues involved in fitting hierarchical GAMs in *mgcv*. In part V, we discuss some of the tools available for plotting model output and assessing model goodness of fit. Finally, in part VI, we work through a few examples of analyses using this approach, to demonstrate the modelling process and how hierarchical GAMs can be incorporated into the quantitative ecologist's toolbox. 




